<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Love Story for My Dearest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for gallery hover effect */
        .gallery-item img {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .gallery-item:hover img {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .gallery-item p {
            transition: color 0.3s ease;
        }
        .gallery-item:hover p {
            color: #db2777;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-pink-100 to-rose-100 text-gray-800 font-sans">
    <!-- Full-screen overlay for photo capture prompt -->
    <div id="photoPrompt" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-md">
            <p class="text-xl mb-6 text-gray-700">Hey love, can I snap a photo to capture your beautiful smile?</p>
            <button id="allowPhoto" class="bg-rose-500 text-white px-6 py-3 rounded-lg hover:bg-rose-600 transition">Allow</button>
            <button id="denyPhoto" class="bg-gray-300 text-gray-800 px-6 py-3 rounded-lg hover:bg-gray-400 transition ml-4">No Thanks</button>
        </div>
    </div>

    <!-- Main content -->
    <div class="container mx-auto p-8">
        <!-- Scrolling names animation -->
        <div class="text-center mb-16">
            <h1 class="text-5xl md:text-7xl font-bold text-rose-600">
                <span id="nameDisplay" class="inline-block transition-opacity duration-1000"></span>
            </h1>
        </div>

        <!-- Novel content -->
        <div class="bg-white p-10 rounded-xl shadow-lg max-w-3xl mx-auto mb-16">
            <h2 class="text-4xl font-semibold text-center mb-8 text-rose-700">Our Spicy Love Story</h2>
            <div id="novelContent" class="prose prose-lg text-gray-700">
                <!-- Replace this with your novel content -->
                <p>Once upon a time, in a world filled with magic, there was youâ€”my muse, my love, my everything. This story is for you, written with every beat of my heart...</p>
                <p>Your laughter lights up my world, and every moment with you feels like a chapter in the greatest romance ever told. [Insert your novel content here]</p>
                <p>Happy Birthday, my darling. May our story continue for a lifetime.</p>
            </div>
        </div>

        <!-- Photo gallery -->
        <div class="bg-white p-10 rounded-xl shadow-lg max-w-4xl mx-auto">
            <h2 class="text-4xl font-semibold text-center mb-8 text-rose-700">Moments Captured</h2>
            <div id="photoGallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
        </div>
    </div>

    <script>
        // Names array for scrolling animation
        const names = ["Sarah", "Sweetie", "My Heart", "Darling", "Love"]; // Replace with your girlfriend's names/nicknames
        let nameIndex = 0;
        const nameDisplay = document.getElementById("nameDisplay");

        // Scrolling animation for names
        function cycleNames() {
            nameDisplay.style.opacity = 0;
            setTimeout(() => {
                nameDisplay.textContent = names[nameIndex];
                nameDisplay.style.opacity = 1;
                nameIndex = (nameIndex + 1) % names.length;
            }, 1000);
        }
        cycleNames();
        setInterval(cycleNames, 3000);

        // Poem generation
        const poemTemplates = {
            adjectives: ["radiant", "gentle", "passionate", "eternal", "captivating", "enchanting", "beloved"],
            nouns: ["heart", "soul", "dream", "love", "star", "flame", "rose"],
            actions: ["whispers", "dances", "shines", "embraces", "blooms", "sparks"],
            places: ["moonlight", "twilight", "heaven", "garden", "forever", "sky"]
        };

        function generatePoem() {
            const adj = poemTemplates.adjectives[Math.floor(Math.random() * poemTemplates.adjectives.length)];
            const noun = poemTemplates.nouns[Math.floor(Math.random() * poemTemplates.nouns.length)];
            const action = poemTemplates.actions[Math.floor(Math.random() * poemTemplates.actions.length)];
            const place = poemTemplates.places[Math.floor(Math.random() * poemTemplates.places.length)];
            return `
                Your ${adj} ${noun} ${action} in my heart,  
                A ${noun} that glows in the ${place}.  
                With every smile, my love does start,  
                Forever yours, in this timeless space.
            `;
        }

        // Photo gallery logic
        const photoGallery = document.getElementById("photoGallery");
        function loadGallery() {
            const photos = JSON.parse(localStorage.getItem("photoGallery") || "[]");
            photoGallery.innerHTML = "";
            photos.forEach(photo => {
                const div = document.createElement("div");
                div.className = "gallery-item text-center";
                div.innerHTML = `
                    <img src="${photo.image}" class="w-full h-48 object-cover rounded-lg mb-2" alt="Captured moment">
                    <p class="text-sm italic text-gray-600">${photo.poem}</p>
                `;
                photoGallery.appendChild(div);
            });
        }
        loadGallery();

        function addToGallery(imageData) {
            const photos = JSON.parse(localStorage.getItem("photoGallery") || "[]");
            photos.push({ image: imageData, poem: generatePoem() });
            localStorage.setItem("photoGallery", JSON.stringify(photos));
            loadGallery();
        }

        // Photo capture logic
        const photoPrompt = document.getElementById("photoPrompt");
        const allowPhoto = document.getElementById("allowPhoto");
        const denyPhoto = document.getElementById("denyPhoto");

        // Check if running on HTTPS or localhost
        function isSecureContext() {
            return window.location.protocol === "https:" || window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";
        }

        // Show photo prompt on page load if webcam is supported
        window.addEventListener("load", () => {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                console.warn("Webcam not supported in this browser.");
                alert("This browser doesn't support webcam access. Enjoy the story!");
                return;
            }
            if (!isSecureContext()) {
                console.warn("Webcam access requires HTTPS or localhost.");
                alert("Please access this site via HTTPS to use the webcam. Enjoy the story!");
                return;
            }
            photoPrompt.classList.remove("hidden");
        });

        allowPhoto.addEventListener("click", async () => {
            photoPrompt.classList.add("hidden");
            try {
                // Request webcam access with explicit constraints
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: "user", // Prefer front-facing camera
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    } 
                });
                console.log("Webcam access granted");
                const video = document.createElement("video");
                video.srcObject = stream;
                video.play();

                // Wait for video to be ready
                await new Promise((resolve, reject) => {
                    video.onloadedmetadata = () => {
                        console.log("Video metadata loaded");
                        resolve();
                    };
                    video.onerror = () => reject(new Error("Video stream error"));
                });

                // Capture photo after a short delay
                setTimeout(() => {
                    try {
                        const canvas = document.createElement("canvas");
                        canvas.width = video.videoWidth || 640;
                        canvas.height = video.videoHeight || 480;
                        const context = canvas.getContext("2d");
                        if (!context) {
                            throw new Error("Failed to get canvas context");
                        }
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                        const imageData = canvas.toDataURL("image/png");
                        console.log("Photo captured, base64 length:", imageData.length);

                        // Add to gallery
                        addToGallery(imageData);
                        alert("Photo captured and added to gallery! Enjoy the story!");

                        // Clean up
                        stream.getTracks().forEach(track => track.stop());
                    } catch (error) {
                        console.error("Capture error:", error.message);
                        alert(`Failed to capture photo: ${error.message}. Enjoy the story!`);
                    }
                }, 1000);
            } catch (error) {
                console.error("Webcam error:", error.name, error.message);
                let errorMsg = "Couldn't access the webcam";
                if (error.name === "NotAllowedError") {
                    errorMsg = "Webcam permission denied";
                } else if (error.name === "NotFoundError") {
                    errorMsg = "No webcam found";
                } else if (error.name === "NotReadableError") {
                    errorMsg = "Webcam is already in use";
                } else if (error.name === "SecurityError") {
                    errorMsg = "Webcam access requires HTTPS";
                }
                alert(`${errorMsg}. Enjoy the story anyway!`);
            }
        });

        denyPhoto.addEventListener("click", () => {
            photoPrompt.classList.add("hidden");
        });
    </script>
</body>
</html>